(function(b){b.fn.extend({reflect:function(a){a=b.extend({height:1/3,opacity:0.5},a);return this.unreflect().each(function(){var f=this;if(/^img$/i.test(f.tagName)){function e(){var r=f.width,s=f.height,d,p,c,q,n;p=Math.floor((a.height>1)?Math.min(s,a.height):s*a.height);if(b.browser.msie){d=b("<img />").attr("src",f.src).css({width:r,height:s,marginBottom:p-s,filter:"flipv progid:DXImageTransform.Microsoft.Alpha(opacity="+(a.opacity*100)+", style=1, finishOpacity=0, startx=0, starty=0, finishx=0, finishy="+(p/s*100)+")"})[0]}else{d=b("<canvas />")[0];if(!d.getContext){return}q=d.getContext("2d");try{b(d).attr({width:r,height:p});q.save();q.translate(0,s-1);q.scale(1,-1);q.drawImage(f,0,0,r,s);q.restore();q.globalCompositeOperation="destination-out";n=q.createLinearGradient(0,0,0,p);n.addColorStop(0,"rgba(255, 255, 255, "+(1-a.opacity)+")");n.addColorStop(1,"rgba(255, 255, 255, 1.0)");q.fillStyle=n;q.rect(0,0,r,p);q.fill()}catch(o){return}}b(d).css({display:"block",border:0});c=b(/^a$/i.test(f.parentNode.tagName)?"<span />":"<div />").insertAfter(f).append([f,d])[0];c.className=f.className;b.data(f,"reflected",c.style.cssText=f.style.cssText);b(c).css({width:r,height:s+p,overflow:"hidden"});f.style.cssText="display: block; border: 0px";f.className="reflected"}if(f.complete){e()}else{b(f).load(e)}}})},unreflect:function(){return this.unbind("load").each(function(){var f=this,a=b.data(this,"reflected"),e;if(a!==undefined){e=f.parentNode;f.className=e.className;f.style.cssText=a;b.removeData(f,"reflected");e.parentNode.replaceChild(f,e)}})}})})(jQuery);